---
layout: post
title: 문자열 인코딩
categories: [computer]
tags: [computer, encoding]
description: character encoding
comments: true
---

# 웹 서버와 문자열 인코딩

얼마전 개발을 하면서 인코딩때문에 애를 먹었던 경험이 있어서 인코딩에 대해 확실하게 집고 넘어가려고 한다(AJAX는 UTF-8인코딩을 사용하는데, 서버가 EUC-KR이라 문자가 계속 깨지는 현상이 발생).  
우선 문자열 인코딩이란 위키에서 찾아보니 `코드포인트와 비트패턴,옥텟등을 대응시키는 것을 의미한다.`  간단하게 말하면 컴퓨터는 비트의 나열로 문자열을 표현하고, 우리는 글자로 읽어야 하니 **01100001은 문자 'a'로 표현하자**와 같은 약속을 미리 지정해놓은 것이다. 모두가 같은 표현약속을 사용한다면 문제될 것이 전혀 없으나 안타깝게도 다양한 인코딩방식이 존재하고, 각각 한글자를 표현하는데 사용하는 비트의 크기와 대응되는 문자가 다르기 때문에 서로 다른 인코딩간의 통신을 하는 경우 문제가 발생하는 것이다.  

![Image alt]({{ site.baseurl }}/assets/img/encoding1.png "인코딩이 다른 경우 예시")  

그럼 인코딩을 간단하게 하나씩 살펴보고, 어떻게 대처해야 하는지 알아보자.

## 인코딩의 종류

우선 다양한 인코딩의 종류부터 알아보자.

### 1. 아스키코드(ASCII)

American Standard Code for Information Interchange의 약자로 7비트를 사용하는 가장 간단하고 보편적인 인코딩 방식이다. 매우 간단하고 기본적인 영문 글자들을 표현할 수 있지만, 127(2의 7승)가지의 문자밖에 표현할 수 없기때문에 제한적이다.

인터넷에 아스키코드표를 검색하면 확인할 수 있다.

### 2. ISO8859

아스키코드로는 기본적인 영문 문자들박에 표현하지 못하기 때문에, 7비트를 사용하는 기존의 아스키코드에서 1비트를 더 사용하여 표기하는 방식을 말한다.

### 3. EUC-KR

문제는 아스키코드로 표현하기에는 한글의 글자수가 너무 많다는 것이다. 그래서 N바이트 조합형, 3바이트 조합형, 7비트 완성형, 2바이트 완성형 등이 있다고 한다. 혹시 굼금한 사람은 [네이버 D2블로그](http://d2.naver.com/helloworld/19187)에 자세히 설졍이 되어있으니 참고하도록 하자.  

**EUC-KR**은 한글을 표현하기 위해 등장한 인코딩 방식 중 하나로 KSX1001(과거에는 KSC5601로 완성형 글자와 코드가 대응하는 형식)과 KSX1003(과거에는 KS C 5636으로 아스키와 거의 동일)을 사용하는 2바이트의 문자 인코딩이다. 때문에 128아래로는 KS X1003을 기반으로 아스키와같은 문자를 표현하고, 그 이후로 KS X1001을 기반으로 한글을 표현한다.  

안타깝게도 자주 쓰이는 한글 2350자만 표현하도록 되어있기 때문에 쀍과 같은 글자를 표현하지 못할 수 있다.  

### 4. MS949

MS949는 현재는 CP949(코드페이지949)와 동일한 의미로 받아들여도 된다. CP949는 원래 마이크로소프트가 도입한 코드페이지로 KS X1001을 표현하는 코드 페이지였지만, 윈도 95이후로 KS X1001가 표현하지 못하는 한글 8,822자를 추가하여 더 많은 글자를 표현할 수 있도록 한것이다.

### 5. 유니코드

안타깝게도 세상에는 너무나 다양한 문자들이 있고, EUC-KR, 아스키코드 등 위에서 설명한 코드들로는 모든 문자를 동시에 표현하는데 문제가 발생할 수 밖에 없었다.  
그래서 이 문제를 해결하기 위해서 등장한 것이 바로 **유니코드**이다.  

유니코드는 값을 나타내기 위해서 코드포인트를 사용한다. 몇개의 평면으로 구분된 코드포인트가 있는데, 대체로 2바이트만 사용하면 되는 기본 다국어 평면으로 우리가 사용하는 거의 모든 글자를 표현할 수 있으며, 특수한 글자들을 표현하기 위해서 16개의 보조 평면들이 존재한다.  

기본 다국어 평면의 문자 코드는 U+FFFF와 같이 표현하며, 이 이 안에는 물론 한글도 포함되어 있다.  
자세한 유니코드 표는 참조에 있는 유니코드 위키 페이지에서 확인할 수 있다.

### 6. UTF-8

유니코드는 있는 그대로 사용하지 않고 다양한 인코딩 방식을 거쳐서 표현하는데, 그 중 가장 많이 사용하는 방식이 **UTF-8(Universal Coded Character Set + Transformation Format – 8-bit)**이다.  

UTF-8은 가변길이 문자열로 유니코드의 한 글자를 표현하는데 필요한 비트의 수가 한 글자마다 다르게 되어있다.

**UTF-8 변환표**

|코드범위|UTF-16|UTF-8|
|--|--|--|
|000000-00007F|00000000 0xxxxxxx|0xxxxxxx|
|000080-0007FF|00000xxx xxxxxxxx|110xxxxx 10xxxxxx|
|000800-00FFFF|xxxxxxxx xxxxxxxx|1110xxxx 10xxxxxx 10xxxxxx|
|010000-10FFFF|110110yy yyxxxxxx 110111xx xxxxxxxx|11110zzz 10zzxxxx 10xxxxxx 10xxxxxx|

위에서 x로 표현된 부분은 유니코드의 코드를 비트로 순서대로 작성하면 된다.  
한글은 U+1100~U+11FF, U+AC00~U+D7AF의 영역에 포함되어 있기때문에, UTF-8인코딩을 사용하게 되면 한 글자에 3바이트를 사용하게 된다.

### 7. 변형된 UTF-8

자바는 UTF-16으로 문자열을 저장하며, 문자열 직렬화를 할때는 변형된 UTF-8을 이용한다.  
일반적 UTF-8과 다른점은 U+0000을 표현할 때 2바이트의 표기법에 맞추어 표현하기 때문에 C와 같은 언어로 읽어들였을 때 널 문자열이 나타나지 않는다. 또한, 기본 평면을 제외한 문자를 표기할때 4바이트로 한번에 표기할 수 없으므로 둘로 나누어 인코딩한다. 그렇기 때문에 기본평면을 제외한 문자를 표현하는데 6바이트가 필요하다.(자바의 문자는 한 글자에 2바이트를 필요로 한다)


## 참고

[위키 - 아스키코드](https://ko.wikipedia.org/wiki/%EB%AF%B8%EA%B5%AD%EC%A0%95%EB%B3%B4%EA%B5%90%ED%99%98%ED%91%9C%EC%A4%80%EB%B6%80%ED%98%B8)  
[위키 - 코드페이지949](https://ko.wikipedia.org/wiki/%EC%BD%94%EB%93%9C_%ED%8E%98%EC%9D%B4%EC%A7%80_949)  
[위키 - KS X1001](https://ko.wikipedia.org/wiki/KS_X_1001)  
[위키 - 유니코드](https://ko.wikipedia.org/wiki/%EC%9C%A0%EB%8B%88%EC%BD%94%EB%93%9C)
[네이버 D2블로그](http://d2.naver.com/helloworld/19187)  
[위키 - ISO8859-1](https://ko.wikipedia.org/wiki/ISO/IEC_8859-1)  
[위키 - UTF-8](https://ko.wikipedia.org/wiki/UTF-8)  
[위키 - 인코딩](https://en.wikipedia.org/wiki/Character_encoding)
